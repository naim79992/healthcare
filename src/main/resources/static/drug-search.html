<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drug Search (RxNav)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
  <h2 class="text-center mb-4">Drug Search (RxNav)</h2>

  <!-- Search Form -->
  <form id="drugForm" class="mb-3">
    <div class="input-group">
      <input type="text" id="drugInput" class="form-control" placeholder="Enter generic drug name (e.g. paracetamol) or RxCUI (e.g. 341248)">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  </form>

  <!-- Results Table -->
  <table class="table table-bordered" id="drugTable" style="display:none;">
    <thead class="table-secondary">
      <tr>
        <th>RxCUI</th>
        <th>Drug Name</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Back to Home -->
  <a href="index.html" class="btn btn-secondary mt-3">← Back to Prescription Management</a>
</div>

<script>
document.getElementById("drugForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const input = document.getElementById("drugInput").value.trim();
  if (!input) return alert("Please enter a drug name or RxCUI number");

  let url = "";

  // যদি ইউজার শুধু সংখ্যা দেয় -> ধরে নিবো এটা RxCUI
  if (/^\d+$/.test(input)) {
    url = `https://rxnav.nlm.nih.gov/REST/rxcui/${input}/property.json?propName=RxNorm%20Name`;
  } else {
    // নাহলে generic name হিসেবে সার্চ করবে
    url = `https://rxnav.nlm.nih.gov/REST/drugs.json?name=${encodeURIComponent(input)}`;
  }

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("API not found");
    const data = await res.json();

    const tableBody = document.querySelector("#drugTable tbody");
    tableBody.innerHTML = "";

    // যদি RxCUI দিয়ে সার্চ করে
    if (data.propConceptGroup && data.propConceptGroup.propConcept) {
      data.propConceptGroup.propConcept.forEach(drug => {
        const row = `<tr>
          <td>${drug.rxcui}</td>
          <td>${drug.propValue}</td>
        </tr>`;
        tableBody.insertAdjacentHTML("beforeend", row);
      });
    }

    // যদি generic name দিয়ে সার্চ করে
    if (data.drugGroup && data.drugGroup.conceptGroup) {
      data.drugGroup.conceptGroup.forEach(group => {
        if (group.conceptProperties) {
          group.conceptProperties.forEach(drug => {
            const row = `<tr>
              <td>${drug.rxcui}</td>
              <td>${drug.name}</td>
            </tr>`;
            tableBody.insertAdjacentHTML("beforeend", row);
          });
        }
      });
    }

    document.getElementById("drugTable").style.display = "table";
  } catch (err) {
    alert("Error fetching drug data: " + err.message);
  }
});
</script>

</body>
</html>
